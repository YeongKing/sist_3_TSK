package day0206_HomeWork;

import java.awt.FileDialog;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStreamReader;

import javax.swing.JOptionPane;

public class JavaMemoEvent extends WindowAdapter implements ActionListener {

	private JavaMemoDesign jmd;

	public JavaMemoEvent(JavaMemoDesign jmd) {
		this.jmd = jmd;

	}

	public JavaMemoDesign getJmd() {
		return this.jmd;
	}

	@Override
	public void windowClosing(WindowEvent e) {

		jmd.dispose();
	}

	@Override
	public void actionPerformed(ActionEvent ae) {

		if (ae.getSource() == jmd.jmi1) {
			// System.out.println("새클버튼 클릭");

			if (!(jmd.getTitle().equals("메모장") || jmd.getTitle().equals("메모장 - 새글"))) {
				// 타이틀이 "메모장"이거나 "메모장 - 새글"이 아니라면 열기를 진행한 상태

				System.out.println("열기행위를 수행하였음");

				/*
				 * if(변경된 내용이 있다면) {
				 * 
				 * int option = JOptionPane.showConfirmDialog(null,"저장하시겠습니까?");
				 * 
				 * 
				 * 저장 여부를 묻고, 열기한 파일에 저장한 후
				 * 
				 * jmd.area.setText(""); jmd.area.requestFocus(); jmd.setTitle("메모장 - 새글");
				 * 
				 * 
				 * 
				 * }else{//변경된 내용이 없다면
				 * 
				 * jmd.area.setText(""); jmd.area.requestFocus(); jmd.setTitle("메모장 - 새글");
				 * 
				 * 
				 * 
				 * }
				 * 
				 * 
				 */

			} else {

				// 열기를 진행하지않은 경우 -> 새글상태

				if (jmd.getArea().getText().isEmpty()) {
					// jmd.getArea()에 내용이 없다면
					System.out.println("비어있음");
					jmd.area.setText("");
					jmd.area.requestFocus();
					jmd.setTitle("메모장 - 새글");

				} else {
					// jmd.getArea()에 내용이 있다면
					System.out.println("내용이 존재함");
					int option = JOptionPane.showConfirmDialog(null, "저장하시겠습니까?");
					switch (option) {
					case JOptionPane.OK_OPTION:// 예 선택시
						System.out.println("예가 선택되었음");

						FileDialog fdSave = new FileDialog(jmd, "파일 저장", FileDialog.SAVE);

						fdSave.setVisible(true);

						String path = fdSave.getDirectory();

						String fName = fdSave.getFile();
						System.out.println("디렉토리 : " + path);
						System.out.println("파일명 : " + fName);

						File saveFile = new File(path + fName + ".txt");
						// System.out.println(saveFile);
						BufferedWriter bw = null;
						try {
							bw = new BufferedWriter(new FileWriter(saveFile));

							bw.write(jmd.getArea().getText());
							bw.flush();
							bw.close();
							jmd.area.setText("");
							jmd.area.requestFocus();
							jmd.setTitle("메모장 - 새글");

						} catch (IOException ie) {
							ie.printStackTrace();
						}

					}

				}

			}

		}

		//////////////////////////////////////////////
		if (ae.getSource() == jmd.jmi1_1) {
			// System.out.println("열기버튼 클릭");
			
			
			if (jmd.getArea().getText().isEmpty()) {//jmd.area에 내용이 없다면.

			FileDialog fdOpen = new FileDialog(jmd, "파일 열기", FileDialog.LOAD);
			fdOpen.setVisible(true);

			String path = fdOpen.getDirectory();
			String fName = fdOpen.getFile();

			File readFile = new File(path + fName);

			System.out.println(readFile);

			if (!readFile.exists()) {

				System.out.println(readFile.getAbsolutePath() + "는 존재하지 않습니다.");
				return;
			}

			BufferedReader br = null;
			try {
				br = new BufferedReader(new InputStreamReader(new FileInputStream(readFile)));

				String str = "";
				while ((str = br.readLine()) != null) {

					jmd.getArea().append(str+"\n");

				} // end while
				br.close();
			} catch (IOException ie) {
				ie.printStackTrace();
			}

			if (path != null) {// 취소를 누르면 경로나 파일명에 null 입력

				jmd.setTitle("열기 " + path + "/" + fName);// 타이틀 이름변경 메서드

			} // end if
			
			}
		}
		if (ae.getSource() == jmd.jmi1_2) {
			// System.out.println("저장버튼 클릭");

			FileDialog fdSave = new FileDialog(jmd, "파일 저장 ", FileDialog.SAVE);
			fdSave.setVisible(true);

			String path = fdSave.getDirectory();
			String fName = fdSave.getFile();

			if (path != null) {// 취소를 누르면 경로나 파일명에 null 입력

				jmd.setTitle("저장 " + path + "/" + fName);// 타이틀 이름변경 메서드

			} // end if

		}
		if (ae.getSource() == jmd.jmi1_3) {
			// System.out.println("종료버튼 클릭");
			jmd.dispose();

		}
		if (ae.getSource() == jmd.jmi2) {
			// System.out.println("글꼴버튼 클릭");
			new MemoFontDesign(jmd);

		}
		if (ae.getSource() == jmd.jmi3) {
			// System.out.println("메모장정보 버튼 클릭");

			new MemoHelpDesign(jmd);

		}

	}

}
